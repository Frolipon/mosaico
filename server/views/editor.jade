extends _layout.jade

block head-content

  meta(name="viewport", content="width=1024, initial-scale=1")

  script(src="/lib/badsender-lib-editor.js")
  link(rel="stylesheet", href="/badsender.css")
  script(src="/badsender.js")

  script.
    $(function() {
      if (!Badsender.isCompatible()) {
        alert('Update your browser!');
        return;
      }
      // var basePath = window.location.href.substr(0, window.location.href.lastIndexOf('/')).substr(window.location.href.indexOf('/','https://'.length));
      var basePath  = window.location.protocol + '#{_basePath}';
      var plugins   = [];
      // A basic plugin that expose the "viewModel" object as a global variable.
      // plugins = [function(vm) {window.viewModel = vm;}];
      var ok = Badsender.init({
        strings:                !{data.translations},
        metadata:               !{printJS(data.meta)},
        data:                   !{printJS(data.data)},
        imgProcessorBackend:    basePath + '/img/',
        emailProcessorBackend:  basePath + '/dl/',
        titleToken:             'BADSENDER Responsive Email Designer',
        fileuploadConfig: {
          //- don't prepend basePath
          //- CORS errors can occur while using browsersync
          url: '/upload/',
          // messages??
        },
      }, plugins);
      if (!ok) {
        console.error("config not setted properly");
        //- document.location = ".";
      }
    });

block content
  body.mo-standalone
